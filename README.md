# HappyNewYear

## 前言

至于这个工具，是我在大年三十一大早起来突发奇想想到的，以我个人来理解，拜年时过0点了几百年了你才给人家发祝福和卡着0点发带来的效果应该是完全不一样的（养生党除外）。这个工具可能会给别人带去一种错觉是，你在卡着0点给别人发祝福，最重要的是，它支持对每个不同的联系人定义不同的消息，以至于对每个联系人都好像你亲自卡着0点在发一样。那么稍加观察，你可以很清楚地看出，你在发送的这批人中哪些是你真正值得关怀的，哪些是可以删好友地（反正我看出来了，还真有）

因为只用了一点点时间构思和写代码，以及后期没有做过多的测试，所以实际上使用起来还会不会出其他的问题我就不知道了，至少，我在使用时，一切正常。

如有疑问，欢迎提出，如发现BUG，欢迎PR，如有更好的建议，欢迎提出或者发PR

过年了，这才是程序员该做的事情啊 (ಥ _ ಥ)

## 准备

开发环境 Python 3.7 + PyCharm Pro

平台 Windows 10 x64

Py所需依赖 **wxpy** json **sqlite3** **ntplib** time 其中，加粗为非内置依赖，需要使用pip手动安装

## 一点点的想法

用完之后又静下来想了想，其实这个程序也并不是非常完美

* 我总共发送了58条消息，总共发送使用了9秒时间（因为是按序的），其实想一想可以给每个发送任务单独使用threading开出来一个线程，这么多线程可以同步发送，理论上应该能实现1秒左右同步发送完成吧。
* NTP的同步授时机制多少有点问题，其实想剩最后20秒时就不再出休眠直接疯狂同步授时了，对时间点把握会更精准一些
* 我使用的NTP服务器和国家授时中心的时间竟然相差了一秒，所以我踌躇了半个小时决定要不要在开始发送前再休眠0.8秒以确保没有提前发送
* 有朋友测过，微信每分钟消息限制在120条，所以一分钟内给联系人发到120条后就直接会被block掉，从而触发一段时间内的封禁（有点扯），不过我58条发送正常
* 发送过程的异常捕获写的很简单，时间不够，如果报错请自行检查是否成功发送出去了
* 发送的时间戳请自行修改，在代码第51行

## 使用方法

该工具最大的特色是，配置文件比代码还要长（这取决于你给多少个人发送了消息）。配置文件为message.json，使用前需要提前准备配置文件
```json
{
  "message": [
    {
      "comment": "注释",
      "sn": 1,
      "rname": "备注名称",
      "send": "发送的内容"
    },
    {
      "comment": "注释",
      "sn": 2,
      "rname": "备注名称",
      "send": "发送的内容"
    },
    {
      "comment": "",
      "sn": 3,
      "rname": "",
      "send": ""
    },
    {
      "comment": "",
      "sn": 4,
      "rname": "",
      "send": ""
    }
  ]
}
```
发送的联系人还有再多，可以手动增加
```json
{
      "comment": "",
      "sn": 4,
      "rname": "",
      "send": ""
}
```
其中，
* comment为备注，该数据全程不会被使用到，由于JSON规范不支持注释，所以通过这种方式实现注释；
* sn为序列号，**序列号一定需要是从1开始并且依次加1递增**，每次发送会按照这个顺序从小到大发送；
* rname为该联系人在你微信的备注名称，在你的微信搜索框里建议搜索这个名称只会出来唯一的联系人，不然好像会报错（好像，我不确定，我没有去看wxpy的搜索实现方式）；
* send为发送消息的内容，支持emoji表情，具体请自行去查emoji的编码表，在发送消息中直接写入"\ue404"这样的，发送后对方看到的直接就是对应的emoji


额外提醒一点的是，
* 当rname相同时，但是sn不同，可以实现对一个联系人多次发送消息的
* 发送祝福你已经开挂了，请务必吧祝福语好好写，不要给别人留下不好的印象，我一般看到群发的祝福就直接不再认真回复了，至少觉得没有太多诚意吧，但是包含对方名字或者外号的，这时候反而会成为加分项
* 通过回复情况你差不多可以评估出来哪些人是看到你挨个在发认真回复你的，哪些是在敷衍你的。至于敷衍的那些朋友们，我已经记录下来了，印象会打折扣

## 扩展功能

get_all_friend_data函数：

其可以将好友备注遍历到SQLite数据库中，起初我只是为了去查找对应的puid，后来在wxpy上看到有人讲puid是基于好友名称+备注+性别等等几个信息计算来的，如果恰巧你朋友年头改了昵称的话，你可能就凉了

相应的数据库格式在Init.SQL中，自行查看

## 特别注意

* **不要使用wxpy提供的puid，不要使用wxpy提供的puid，不要使用wxpy提供的puid**，据官方说法，一旦好友改了昵称你可能就无法通过puid找到TA了！！
* 写完message.json后不要再改好友的备注，除非你知道你这是在做什么！
* 建议，如果临时修改了好友信息，记得删除目录下的**cache.pkl**和**puid.pkl**文件并重新登录，以确保不会出什么问题，小心行得万年船
* 对了，还有一个非常严重的问题，，建议最好提前做好准备回复，我的小工具在发完后1分钟我的微信竟然有了66个未读。。。然后我花了许久才回复完。。好累